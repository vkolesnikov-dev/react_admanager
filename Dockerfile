# КОД. ФАЙЛ: Dockerfile (В КОРНЕ ПРОЕКТА)

################################################################
# СТАДИЯ 1: СБОРКА ПРИЛОЖЕНИЯ (BUILD STAGE)
################################################################
# Используем последнюю версию Node.js для сборки (компиляции) React-приложения
FROM node:20-alpine AS builder

# Устанавливаем рабочую директорию в контейнере
WORKDIR /app

# Копируем файлы манифеста и устанавливаем зависимости
COPY package.json package-lock.json ./
RUN npm install

# Копируем остальной код
COPY . .

# Запускаем сборку проекта (создание папки 'dist' или 'build' в зависимости от конфигурации)
# Предполагаем, что ваша команда сборки - 'npm run build' и она создает папку 'dist'
RUN npm run build


################################################################
# СТАДИЯ 2: РАЗВЕРТЫВАНИЕ NGINX (PRODUCTION STAGE)
################################################################
# Используем легковесный образ Nginx для продакшен-среды
FROM nginx:alpine AS runner

# Копируем конфигурационный файл Nginx
# Мы будем использовать собственный конфиг, чтобы Nginx знал, как обрабатывать роутинг React (SPA)
COPY nginx.conf /etc/nginx/conf.d/default.conf

# Копируем собранные статические файлы из стадии 'builder' в директорию Nginx
# ВАЖНО: Убедитесь, что 'dist' соответствует папке, которую создает 'npm run build'
COPY --from=builder /app/dist /usr/share/nginx/html

# Порт, который Nginx слушает по умолчанию
EXPOSE 80

# Команда запуска Nginx (по умолчанию)
CMD ["nginx", "-g", "daemon off;"]